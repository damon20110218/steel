<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>公司信息管理</title>
<!-- 导入jquery核心类库 -->
<script type="text/javascript" src="dist/js/jquery-3.4.1.min.js"></script>
<!-- 导入easyui类库 -->
<link rel="stylesheet" type="text/css" href="css/easyui.css">
<link rel="stylesheet" type="text/css" href="css/icon.css">
<script type="text/javascript" src="dist/js/jquery.easyui.min.js"></script>
<script src="dist/js/easyui-lang-zh_CN.js" type="text/javascript"></script>
<script type="text/javascript">
	function doAdd() {
		$('#addStaffWindow').window("open");
	}

	function doDelete() {
		var rows = $("#grid").datagrid("getSelections");
		if (rows.length == 0) {
			$.messager.alert("提示", "请选择!", "warning");
		} else {
			$.messager.confirm("删除确认", "你确定要删除选中项吗?", function(r) {
				if (r) {
					//确定删除,发送请求
					/* for(var i=0;i<rows.length;i++){
					    } */
					location.href = "staffAction_deleteBatch?ids="
							+ JSON.stringify(rows);
				}
			});

		}
	}
	//工具栏
	var toolbar = [ {
		id : 'button-add',
		text : '增加',
		iconCls : 'icon-add',
		handler : doAdd
	} ];
	// 定义列
	var columns = [ [
			{
				field : 'clientId',
				checkbox : true,
			},
			{
				field : 'clientName',
				title : '公司名称',
				width : 120,
				align : 'center'
			},
			{
				field : 'mobile',
				title : '电话',
				width : 120,
				align : 'center'
			},
			{
				field : 'telephone',
				title : '手机',
				width : 120,
				align : 'center'
			},
			{
				field : 'email',
				title : '邮箱',
				width : 120,
				align : 'center'
			},
			{
				field : 'address',
				title : '地址',
				width : 120,
				align : 'center'
			},
			{
				field : 'contactPerson',
				title : '联系人名称',
				width : 200,
				align : 'center'
			},
			{
				field : 'clientMark',
				title : '备注',
				width : 120,
				align : 'center'
			},
			{
				field : 'opt',
				title : '操作栏',
				width : 300,
				align : 'center',
				formatter : function(value, row, index) {
					var str = '<input class="easyui-linkbutton" type="button" value="修改"> &nbsp; <input class="easyui-linkbutton" type="button" value="删除">';
					return str;
				}
			} ] ];

	$(function() {
		// 先将body隐藏，再显示，不会出现页面刷新效果
		$("body").css({
			visibility : "visible"
		});

		// 取派员信息表格
		$('#company').datagrid({
			iconCls : 'icon-forward',
			width : 1300,
			height : 600,
			border : true,
			rownumbers : true,
			striped : true,
			queryParams : {
				'clientType' : '1'
			},
			pageList : [ 10, 20, 30 ],
			pagination : true,
			toolbar : toolbar,
			url : "http://localhost:8080/basic/list_client",
			dataType : "jsonp",
			idField : 'clientId', //识别id,重点
			columns : columns
		});

		// 添加取派员窗口
		$('#addStaffWindow').window({
			title : '添加公司',
			width : 600,
			modal : true,
			shadow : true,
			closed : true,
			height : 500,
			resizable : true
		});

	});
	function query() {
		var queryParams = $('#company').datagrid('options').queryParams;
		var clientName = $('#search').val();
		queryParams.clientName = clientName;
		$('#company').datagrid('options').queryParams = queryParams;
		$("#company").datagrid('reload');
	}
	function closeWindow() {
		$('#addStaffWindow').window("close");
	}
	function saveCompany() {
		var formObject = {};
        var formArray =$("#addStuffForm").serializeArray();
        $.each(formArray,function(i,item){
            formObject[item.name] = item.value;
        });
		$.ajax({
			type : "post", //数据提交方式（post/get）
			url : "/basic/update_client", //提交到的url
			contentType: "application/json; charset=utf-8",
            data: JSON.stringify(formObject),
			//dataType : "json",//返回的数据类型格式
			success : function(msg) {
				if (msg == "Success") { //修改成功
					//修改成功处理代码...
					$('#addStaffWindow').window("close");
					query();
				} else { //修改失败
					//修改失败处理代码...
					$.messager.alert('系统提示','公司信息保存失败','error');
				}
			}
		});
	}
</script>
</head>
<body class="easyui-layout" style="visibility: hidden;">
	<div region="center" border="false">
		<input class="easyui-textbox" id="search"
			data-options="prompt:'请输入公司名称',iconCls:'icon-man'"
			style="width: 200px; height: 40px"> <input
			class="easyui-linkbutton" type="button" value="查询" onclick="query()"
			style="width: 100px; height: 34px" />
		<table id="company"></table>
	</div>
	<div class="easyui-window" title="公司进行添加或者修改" id="addStaffWindow"
		collapsible="false" minimizable="false" maximizable="false"
		style="top: 200px; left: 200px">
		<div region="north" style="height: 31px; overflow: hidden;"
			split="false" border="false">
			<div class="datagrid-toolbar">
				<a id="save" icon="icon-save" onclick="saveCompany()"
					class="easyui-linkbutton" plain="true">保存</a> <a id="save"
					icon="icon-cancel" onclick="closeWindow()"
					class="easyui-linkbutton" plain="true">关闭</a>
			</div>
		</div>

		<div region="center" style="overflow: auto; padding: 5px;"
			border="false">
			<form id="addStuffForm" method="post">
				<table class="table-edit" width="80%" align="center">
					<tr class="title">
						<td colspan="2">公司信息</td>
					</tr>
					<tr hidden="true">
						<td>公司ID</td>
						<td><input type="text" name="clientId" />
						<input type="text" name="clientType" value="1"/>
						</td>
						
					</tr>
					<tr>
						<td>公司名称</td>
						<td><input type="text" name="clientName" class="easyui-textbox"
							required="true" /></td>
					</tr>
					<tr>
						<td>电话</td>
						<td><input
							name="telephone" class="easyui-textbox" required="true" /></td>
					</tr>
					<tr>
						<td>手机</td>
						<td><input type="text" name="mobile" class="easyui-textbox"
							required="true" /></td>
					</tr>
					<tr>
						<td>邮箱</td>
						<td><input type="text" name="email" class="easyui-textbox"
							required="true" /></td>
					</tr>
					<tr>
						<td>地址</td>
						<td><input type="text" name="address" class="easyui-textbox"
							required="true" /></td>
					</tr>
					<tr>
						<td>联系人姓名</td>
						<td><input type="text" name="contactPerson" class="easyui-textbox"
							required="true" /></td>
					</tr>
					<tr>
						<td>备注</td>
						<td><input type="textarea" name="clientMark"
							class="easyui-textbox" required="true" /></td>
					</tr>
				</table>

			</form>
		</div>
	</div>
</body>
</html>
